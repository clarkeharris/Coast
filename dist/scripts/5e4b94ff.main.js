Parse.initialize("BA1C8ZngmJPQ6vOTvtCCJq9SEWEBBAR5vPoNuxtE","tAX4S5an89EtItKoTz8SsOrRr50VEZMoBUeshZ2J"),$(document).ready(function(){$(".upload-feature").click(function(){var a=$(this).next();a.animate({left:0==parseInt(a.css("left"),10)?-a.outerWidth():0})})});var PostModel=Parse.Object.extend({className:"UploadPhoto",defaults:{}}),ForecastModel=Parse.Object.extend({className:"SurfSpotsForecast",defaults:{}}),PostsCollection=Parse.Collection.extend({model:PostModel}),SpotsCollection=Backbone.Collection.extend({model:ForecastModel}),AppView=Parse.View.extend({className:"post-view"}),app=new AppView,HomeView=Parse.View.extend({className:"home-view",template:_.template($(".home-view-template").text()),events:{"click .direct-to-login-button":"login","click .sign-up-button":"signUp"},initialize:function(){$(".container").prepend(this.el),$(".posts-container").hide(),this.render()},render:function(){return this.$el.html(this.template()),this},login:function(){router.navigate("#/login",{trigger:!0})},signUp:function(){router.navigate("#/sign-up",{trigger:!0})}}),LoginView=Parse.View.extend({className:"login-view",template:_.template($(".login-view-template").text()),events:{"click .login-button":"login"},initialize:function(){$(".container").prepend(this.el),this.render()},render:function(){return this.$el.html(this.template()),this},login:function(){Parse.User.logIn($(".login-username").val(),$(".login-password").val(),{success:function(){$(".login-username").val(""),$(".login-password").val(""),router.navigate("dashboard",{trigger:!0})},error:function(){}})}}),SignUpView=Parse.View.extend({className:"sign-up-view",template:_.template($(".sign-up-view-template").text()),events:{"click .submit-sign-up-button":"signUp"},initialize:function(){$(".container").append(this.el),$(".posts-container").hide(),this.render()},render:function(){return this.$el.html(this.template()),this},signUp:function(){var a=new Parse.User;a.set("username",$(".sign-up-username").val()),a.set("password",$(".sign-up-password").val()),a.set("email",$(".sign-up-email").val()),a.signUp(null,{success:function(){router.navigate("#/dashboard",{trigger:!0})},error:function(a,b){alert("Error: "+b.code+" "+b.message)}})}}),currentPosition={},DashboardView=Parse.View.extend({className:"dashboard-view",template:_.template($(".dashboard-view-template").text()),events:{"click .upload-button":"uploadPhoto","click .logout-button":"logOut","click .upload-feature":"uploadFeature","click .search":"forecastName"},initialize:function(){$(".container").append(this.el),this.render(),this.forecastName(),this.collection=new PostsCollection,this.collection.on("add",this.addPost),this.fetchPromise=this.collection.fetch({add:!0}),$(".search-region").keydown(function(a){13===a.which&&$(".search").click()}),this.fetchPromise.done(function(){imagesLoaded(document.querySelectorAll(".posts-view"),function(){new Masonry($(".posts-container")[0],{columnWidth:0,itemSelector:".posts-view"});$(".posts-container").addClass("visible"),$(".triangle").mouseenter(function(){var a=$(".triangle").index(this);$(".wind-right:eq("+a+")").css("opacity",1),$(".wind-time:eq("+a+")").css("opacity",1)}).mouseleave(function(){var a=$(".triangle").index(this);$(".wind-right:eq("+a+")").css("opacity",0),$(".wind-time:eq("+a+")").css("opacity",0)})})});new Masonry($("#container")[0],{columnWidth:0,itemSelector:".item"})},render:function(){return this.$el.html(this.template()),this},addPost:function(a){new PostsView({model:a})},logOut:function(){Parse.User.logOut();Parse.User.current();router.navigate("#/login",{trigger:!0})},uploadFeature:function(){},uploadPhoto:function(){var a=$(".file-uploader")[0];if(a.files.length>0)var b=a.files[0],c="photo.jpg",d=new Parse.File(c,b);var e=d.save();e.then(function(){console.log("Mostly Succesful")},function(){console.log("Upload Failed")});var f=this;e.done(function(){var a=new Parse.Object("UploadPhoto");if(a.set("parent",Parse.User.current().attributes.username),a.set("photo",d.url()),a.set("photoRef",d),a.set("wave_height",$(".wave-height-selection option:selected").text()),a.set("wind_direction",$(".wind-direction-selection option:selected").text()),a.set("tide",$(".tides-selection option:selected").text()),a.set("crowd",$(".crowd-selection option:selected").text()),a.set("caption",$(".caption").val()),$(".current-location").is(":checked")){var b=Parse.GeoPoint.current();b.done(function(b){var c=new Parse.GeoPoint({latitude:b.latitude,longitude:b.longitude});a.set("location",c),a.save().done(function(){Parse.User.current().relation("posts").add(a),Parse.User.current().save()})})}else a.save().done(function(){Parse.User.current().relation("posts").add(a),Parse.User.current().save()});f.collection.add(a)})},forecastName:function(){var a=this,b=(new SpotsCollection,$(".search-region").val().replace(" ","-").replace(",","").toLowerCase());$.get("http://0.0.0.0:3000/api/county/water-temperature/"+b).done(function(a){$(".forecast-location").html(""),$(".forecast-location").append(a.county),$(".water-temp").html(""),$(".water-temp").append("Water Temperature: "+a.fahrenheit)}),$.get("http://0.0.0.0:3000/api/county/wind/"+b).done(function(a){var b=_.pluck(a,"direction_degrees"),c=_.pluck(a,"speed_mph"),d=_.filter(c,function(a,b){return b%2==0}),e=d.map(Math.round),f=_.pluck(a,"hour"),g=_.filter(f,function(a,b){return b%2==0}),h=[];e.forEach(function(a){h.push({windSpeedMph:a})}),g.forEach(function(a,b){h[b].hour=a}),h.forEach(function(a){var b=_.template($(".wind-speed-template").text()),c=b(a);$(".wind").append(c)});var i=_.filter(b,function(a,b){return b%2==0});i.forEach(function(a){var b={windDirection:a},c=_.template($(".arrow-template").text()),d=c(b);$(".wind").append(d)})}),$.get("http://0.0.0.0:3000/api/spot/all").done(function(a){_.each(a,function(a){a.county_name.toLowerCase()==b&&(currentPosition.longitude=a.longitude,currentPosition.latitude=a.latitude)})}),$.get("http://0.0.0.0:3000/api/county/swell/"+b).done(function(a){_.each(a,function(a){_.each(a,function(){})})}),$.get("http://0.0.0.0:3000/api/county/swell/"+b).done(function(b){var c=[],d=[];_.each(b,function(a){c.push(a.hour),d=d.map(function(a){return parseFloat(a.toFixed(2))}),d.push(3*a.hst)});var e={labels:c,datasets:[{label:"Swell Height",fillColor:"rgba(7,60,96,1)",strokeColor:"rgba(220,220,220,1)",pointColor:"rgba(220,220,220,1)",highlightFill:"rgba(95,149,214,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:d}]};a.myBarChart&&a.myBarChart.destroy();var f=document.getElementById("wave-height-chart").getContext("2d");f.canvas.width=530,f.canvas.height=275,f.canvas.width=$("#wave-height-chart").width(),f.canvas.height=$("#wave-height-chart").height(),a.myBarChart=new Chart(f).Bar(e,{scaleShowGridLines:!1,showTooltips:!0,barShowStroke:!1,scaleShowLabels:!1,showScale:!1})}),$.get("http://0.0.0.0:3000/api/county/tide/"+b).done(function(b){var c=_.pluck(b,"hour"),d=_.pluck(b,"tide"),e=_.filter(c,function(a,b){return b%2==0}),f=_.filter(d,function(a,b){return b%2==0}),g=f.map(Math.round),h=_.pluck(b,"date")[0];$(".date").html(""),$(".date").append(h);var b={labels:e,datasets:[{label:"Tides",fillColor:"rgba(220,220,220,0.0)",strokeColor:"rgba(255,255,255,1)",pointColor:"rgba(220,220,220,1)",pointStrokeColor:"rgba(220,220,220,0.0)",pointHighlightFill:"rgba(251,61,73,1)",pointHighlightStroke:"rgba(220,220,220,0.0)",data:g}]};a.myLineChart&&a.myLineChart.destroy();var i=document.getElementById("tide-chart").getContext("2d");i.canvas.width=$("#tide-chart").width(),i.canvas.height=$("#tide-chart").height(),a.myLineChart=new Chart(i).Line(b,{caleShowGridLines:!1,showTooltips:!0,barShowStroke:!1,scaleShowLabels:!1,showScale:!1})}),this.googleMaps()},googleMaps:function(){function a(){var a=$(".search-region").val().replace(",","").toLowerCase();$.get("http://0.0.0.0:3000/api/spot/all").done(function(b){_.each(b,function(b){b.county_name.replace("-"," ").toLowerCase()==a&&(currentPosition.longitude=b.longitude,currentPosition.latitude=b.latitude)});var c={center:new google.maps.LatLng(currentPosition.latitude,currentPosition.longitude),zoom:8};console.log("before map",c);new google.maps.Map(document.getElementById("map-canvas"),c)});{var b={center:new google.maps.LatLng(currentPosition.latitude,currentPosition.longitude),zoom:1};new google.maps.Map(document.getElementById("map-canvas"),b)}}a()}}),PostsView=Parse.View.extend({className:"posts-view",template:_.template($(".posts-view-template").text()),events:{},initialize:function(){$(".posts-container").append(this.el),this.render()},render:function(){return renderTemplate=this.template(this.model.attributes),this.$el.html(renderTemplate),this}});console.log("router file loaded");var AppRouter=Backbone.Router.extend({routes:{"":"homePage",login:"loginPage","sign-up":"signUpPage",dashboard:"dashboardPage",post:"post","profile/:username":"userProfile"},initialize:function(){console.log("router initialize"),postsCollection=new PostsCollection},homePage:function(){$(".container").html(""),$(".posts-container").html(""),new HomeView},loginPage:function(){$(".container").html(""),$(".posts-container").html(""),new LoginView},signUpPage:function(){$(".container").html(""),$(".posts-container").html(""),new SignUpView},dashboardPage:function(){$(".container").html(""),new DashboardView({model:Parse.User.current()})}}),router=new AppRouter;Backbone.history.start();